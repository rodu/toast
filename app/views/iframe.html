<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Diplodoc Test Results Collection IFrame</title>
        <script src="/lib/jquery/dist/jquery.min.js"></script>
    </head>
    <body>
        <div id="post-result"></div>
        <script>
            $(function(){
                var $postResults = $("#post-result"),
                    onEvent = window.addEventListener || window.attachEvent ||  function(){
                            console.error("Not support for standard event listeners... Come on...");
                        };
                onEvent("message", function(event){
                    var data = event.data;
                    console.log("Got message from ", event.origin);
                    //window.parent.postMessage("test message", event.origin);
                    $.ajax({
                        type: "POST",
                        url: "/api/testruns",
                        data: data.testruns,
                        dataType: "json"
                    
                    }).done(function(data){
                        window.parent.postMessage({
                            success: true,
                            message: data.message
                        }, event.origin);

                    }).fail(function(jqXHR, textStatus){
                        window.parent.postMessage({
                            success: false,
                            message: textStatus
                        }, event.origin);
                    
                    });
                });
            });
        </script>
    </body>
</html>
